<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lock Support | Java-Concurrent</title>


<link rel="stylesheet" href="/Java-Concurrent/book.min.79de1f7861b0c98f453c0a93bebf3608a280809e417787746c373699639900d7.css">




<link rel="icon" href="/Java-Concurrent/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://hello-world-example.github.io/Java-Concurrent/">Java-Concurrent</a>
</h2>






    
  
  
  

  <style>
  nav ul a[href$="\2fJava-Concurrent\2f docs\2fjava.util.concurrent\2flocks\2fLockSupport\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><strong>java.lang</strong>

<ul>
<li><a href="/Java-Concurrent/docs/java.lang/Thread/">Thread</a></li>
<li><a href="/Java-Concurrent/docs/java.lang/ThreadLocal/">ThreadLocal</a></li>
</ul></li>
<li><strong>sun.misc</strong>

<ul>
<li><a href="/Java-Concurrent/docs/sun.misc/Unsafe/">Unsafe</a></li>
</ul></li>
<li><strong>java.util.concurrent.locks</strong>

<ul>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/locks/LockSupport/">LockSupport</a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/locks/AbstractQueuedSynchronizer/">AbstractQueuedSynchronizer</a></li>
<li><del>ReentrantLock</del></li>
<li><del><sup>[8]</sup>StampedLock</del></li>
</ul></li>
<li><strong>java.util.concurrent</strong>

<ul>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/ExecutorService/">ExecutorService<sup>â™¨</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/Future/">Future<sup>â¿</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/ExecutorCompletionService/">ExecutorCompletionService<sup>â¿</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/ForkJoin/"><sup>[7]</sup>ForkJoin<sup>â™¨</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/CompletableFuture/"><sup>[8]</sup>CompletableFuture<sup>â¿</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/CountDownLatch/">CountDownLatch <sup>ğŸ”’</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/Semaphore/">Semaphore<sup>ğŸ”’</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/CyclicBarrier/">CyclicBarrier<sup>ğŸ”’</sup></a></li>
<li><a href="/Java-Concurrent/docs/java.util.concurrent/Phaser/"><sup>[7]</sup> Phaser<sup>ğŸ”’</sup></a></li>
</ul></li>
<li><strong>java.util.concurrent.atomic</strong>

<ul>
<li><del>AtomicLong</del></li>
<li><del><sup>[8]</sup>LongAdder</del></li>
</ul></li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/Java-Concurrent/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Lock Support</strong>
</header>

      
<article class="markdown">

<h1 id="locksupport">LockSupport</h1>

<blockquote>
<p>zh <a href="https://tool.oschina.net/uploads/apidocs/jdk-zh/java/util/concurrent/locks/LockSupport.html">java.util.concurrent.locks.LockSupport</a> å®˜æ–¹æ–‡æ¡£çš„æè¿°ä¹Ÿå¾ˆæ¸…æ¥š</p>
</blockquote>

<ul>
<li><code>LockSupport</code> æ˜¯åŸºäº <code>sun.misc.Unsafe</code> å°è£…çš„ <strong>çº¿ç¨‹é˜»å¡å·¥å…·ç±»</strong></li>
<li>ä¸»è¦æä¾› <code>park</code> å’Œ <code>unpark</code> ï¼Œå³ <strong>é˜»å¡</strong> å’Œ <strong>è§£é™¤é˜»å¡</strong> ä¸¤ç±»åŠŸèƒ½</li>
<li>ç±»ä¼¼äº <code>Object</code> çš„ <strong>wait</strong> å’Œ <strong>notify</strong> ï¼Œä½†æ˜¯<strong>ä¸éœ€è¦è·å– é”å¯¹è±¡</strong>ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸</li>
<li>ç±»ä¼¼äº <code>Thread</code> çš„ <del><strong>suspend</strong></del> å’Œ <strong><del>resume</del></strong> è¿‡æ—¶æ–¹æ³•ï¼Œ<strong>ä¸ä¼šæœ‰äº§ç”Ÿæ­»é”çš„å‰¯ä½œç”¨</strong></li>
<li><code>park</code> å’Œ <code>unpark</code> å¯ä»¥ç†è§£ä¸º <strong>æ“ä½œçº¿ç¨‹çš„è®¸å¯æ ‡ç¤º</strong>ï¼ˆtrue:è®¸å¯ / false:ä¸è®¸å¯ï¼‰

<ul>
<li>ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªè®¸å¯ï¼Œé»˜è®¤æ˜¯ falseï¼Œè°ƒç”¨  <code>park</code>  ç›´æ¥é˜»å¡</li>
<li>å‡å¦‚å…ˆè°ƒåŠ¨  <code>unpark</code> ï¼Œåˆ™çº¿ç¨‹çš„è®¸å¯ä¸º trueï¼Œè°ƒç”¨  <code>park</code>  ç›´æ¥è¿”å›ï¼Œä¸é˜»å¡</li>
<li>å› ä¸ºä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªè®¸å¯ï¼Œè°ƒç”¨å¤šæ¬¡  <code>unpark</code> ä¸1æ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·</li>
<li>å‡å¦‚ä¸€å¼€å§‹æ²¡æœ‰ è®¸å¯ï¼Œè°ƒç”¨  <code>park</code>  é˜»å¡ï¼Œéœ€è¦è°ƒç”¨   <code>unpark</code>  ç»™äºˆè®¸å¯é€šè¡Œï¼Œè§£é™¤é˜»å¡</li>
<li>è§£é™¤é€šè¡Œ <code>park</code> é€šè¿‡å è®¸å¯åˆå˜ä¸º ç¦æ­¢ï¼Œä¸‹æ¬¡  <code>park</code>  æ›¾ç„¶é˜»å¡</li>
</ul></li>
</ul>

<h2 id="ä¸€äº›ç¤ºä¾‹">ä¸€äº›ç¤ºä¾‹</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// å‡å¦‚å…ˆè°ƒåŠ¨ unpark ï¼Œåˆ™çº¿ç¨‹çš„è®¸å¯ä¸º trueï¼Œè°ƒç”¨ park ç›´æ¥è¿”å›ï¼Œä¸é˜»å¡
</span><span style="color:#75715e"></span>{
    LockSupport.<span style="color:#a6e22e">unpark</span>(Thread.<span style="color:#a6e22e">currentThread</span>());
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;â¤ è¿™é‡Œç›´æ¥é€šè¿‡&#34;</span>);
    LockSupport.<span style="color:#a6e22e">park</span>();
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;end&#34;</span>);
}

<span style="color:#75715e">// è°ƒç”¨å¤šæ¬¡ unpark ä¸1æ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·
</span><span style="color:#75715e">// è§£é™¤é€šè¡Œå è®¸å¯ å˜ä¸º ç¦æ­¢ï¼Œä¸‹æ¬¡  park  æ›¾ç„¶é˜»å¡
</span><span style="color:#75715e"></span>{
    LockSupport.<span style="color:#a6e22e">unpark</span>(Thread.<span style="color:#a6e22e">currentThread</span>());
    LockSupport.<span style="color:#a6e22e">unpark</span>(Thread.<span style="color:#a6e22e">currentThread</span>());
  
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;è¿™é‡Œç›´æ¥é€šè¿‡&#34;</span>);
    LockSupport.<span style="color:#a6e22e">park</span>();
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;â¤ è¿™é‡Œä»ç„¶ä¼šé˜»å¡&#34;</span>);
    LockSupport.<span style="color:#a6e22e">park</span>();
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;end&#34;</span>);
}

{
    <span style="color:#66d9ef">final</span> <span style="color:#a6e22e">Thread</span> threadMain <span style="color:#f92672">=</span> Thread.<span style="color:#a6e22e">currentThread</span>();
    <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> {
        <span style="color:#66d9ef">try</span> { Thread.<span style="color:#a6e22e">sleep</span>(2000); } <span style="color:#66d9ef">catch</span> (InterruptedException <span style="color:#a6e22e">e</span>) {  }
        <span style="color:#75715e">// 2s åä¸ºä¸»çº¿ç¨‹è§£é”ï¼ˆè§£é™¤é˜»å¡ï¼‰
</span><span style="color:#75715e"></span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;unpark&#34;</span> <span style="color:#f92672">+</span> System.<span style="color:#a6e22e">currentTimeMillis</span>());
        LockSupport.<span style="color:#a6e22e">unpark</span>(threadMain);
    }).<span style="color:#a6e22e">start</span>();

    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;park  &#34;</span> <span style="color:#f92672">+</span> System.<span style="color:#a6e22e">currentTimeMillis</span>());
    LockSupport.<span style="color:#a6e22e">park</span>();
    System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;ok    &#34;</span> <span style="color:#f92672">+</span> System.<span style="color:#a6e22e">currentTimeMillis</span>());
  
  <span style="color:#75715e">// è¾“å‡º
</span><span style="color:#75715e"></span>  park   ...<span style="color:#a6e22e">1520</span>
  unpark ...<span style="color:#a6e22e">3526</span>
  ok     ...<span style="color:#a6e22e">3526</span>
}</code></pre></div>
<h2 id="park-park-object-blocker">park / park(Object blocker)</h2>

<p>ç¨‹åºå¯åŠ¨ä¹‹åï¼Œé€šè¿‡ <code>jps</code> æ‰¾åˆ°å¯¹åº”çš„ java è¿›ç¨‹ idï¼Œ<code>jcmd &lt;pid&gt; Thread.print</code>  æ‰“å°çº¿ç¨‹æ ˆä¿¡æ¯</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">$ <span style="color:#a6e22e">jps</span>  
$ <span style="color:#a6e22e">jcmd</span> <span style="color:#f92672">&lt;</span>pid<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">Thread</span>.<span style="color:#a6e22e">print</span>
  
{
  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * &#34;main&#34; #1 prio=5 os_prio=31 tid=0x00007fb4e6802000 nid=0x1103 waiting on condition [0x0000700009ca2000]
</span><span style="color:#75715e">   *    java.lang.Thread.State: WAITING (parking)
</span><span style="color:#75715e">   *         at sun.misc.Unsafe.park(Native Method)
</span><span style="color:#75715e">   *         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:304)
</span><span style="color:#75715e">   *         at xyz.kail.demo.java.concurrent.locks.LockSupportParkMain.main(LockSupportParkMain.java:8)
</span><span style="color:#75715e">   */</span>
  LockSupport.<span style="color:#a6e22e">park</span>();
}

{
  <span style="color:#75715e">/**
</span><span style="color:#75715e">   * &#34;main&#34; #1 prio=5 os_prio=31 tid=0x00007f7fc8002000 nid=0xd03 waiting on condition [0x0000700001b1d000]
</span><span style="color:#75715e">   *    java.lang.Thread.State: WAITING (parking)
</span><span style="color:#75715e">   *         at sun.misc.Unsafe.park(Native Method)
</span><span style="color:#75715e">   *         - parking to wait for  &lt;0x000000076ada4748&gt; (a java.util.HashMap)
</span><span style="color:#75715e">   *         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
</span><span style="color:#75715e">   *         at xyz.kail.demo.java.concurrent.locks.LockSupportParkMain.main(LockSupportParkMain.java:18)
</span><span style="color:#75715e">   */</span>
  LockSupport.<span style="color:#a6e22e">park</span>(<span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>());
}</code></pre></div>
<p>å¯ä»¥çœ‹åˆ° åŒºåˆ«åœ¨äº <code>park(Object blocker)</code> ä¼šå¤šä¸€è¡Œ <code>- parking to wait for  &lt;0x000000076ada4748&gt; (a java.util.HashMap)</code> æ˜¾ç¤º <code>blocker</code> çš„ç±»ã€‚</p>

<p><code>blocker</code> å¯¹è±¡ä¼šä¿å­˜åœ¨ <code>Thread</code> å¯¹è±¡çš„ <code>volatile Object parkBlocker</code> å±æ€§ä¸­ï¼Œå¯é€šè¿‡ <code>LockSupport.getBlocker(thread)</code> è·å–ã€‚</p>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="https://github.com/hello-world-example/Java-Concurrent/commit/f8fb2dded015191c584f8a33b2fedd5e4c304191" title='Last modified Feb 17, 2020 by æ¨å‡¯å½¬' target="_blank" rel="noopener">
      <img src="/Java-Concurrent/svg/calendar.svg" alt="Changed" /> Feb 17, 2020
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/hello-world-example/Java-Concurrent/edit/master/HuGo/content/docs/java.util.concurrent/locks/LockSupport.md" target="_blank" rel="noopener">
      <img src="/Java-Concurrent/svg/edit.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#locksupport">LockSupport</a>
<ul>
<li><a href="#ä¸€äº›ç¤ºä¾‹">ä¸€äº›ç¤ºä¾‹</a></li>
<li><a href="#park-park-object-blocker">park / park(Object blocker)</a></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
